<!DOCTYPE html>
<head>
    <meta name="viewport" id="vp" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" />
    <meta charset="utf-8" />

    <script type="module" src="js/anime.js"></script>
    <link rel='stylesheet' href="css/style.css"/>
    
    <link rel="stylesheet" href="https://api.mazemap.com/js/v2.0.63/mazemap.min.css">
    <script type='text/javascript' src='https://api.mazemap.com/js/v2.0.63/mazemap.min.js'></script>
</head>
<body>
    <div id="wrapper">
        <div id="map" class="mazemap"></div>
        <div id="myModal" class="modal" style="display: none; position: relative;">
            <!-- Modal content -->
            <div class="modal-content">
                <button id="close" style="position: relative;">Close</button>
                <div class="page">
                    <div class="container"> 
                        <div class="right">
                            <svg viewBox="0 0 320 300">
                                <defs>
                                    <linearGradient
                                    inkscape:collect="always"
                                    id="linearGradient"
                                    x1="13"
                                    y1="193.49992"
                                    x2="307"
                                    y2="193.49992"
                                    gradientUnits="userSpaceOnUse">
                                    <stop
                                    style="stop-color:#ff00ff;"
                                    offset="0"
                                    id="stop876" />
                                    <stop
                                    style="stop-color:#ff0000;"
                                    offset="2"
                                    id="stop878" />
                                </linearGradient>
                              </defs>
                              <path d="m 40,120.00016 239.99984,-3.2e-4 c 0,0 24.99263,0.79932 25.00016,35.00016 0.008,34.20084 -25.00016,35 -25.00016,35 h -239.99984 c 0,-0.0205 -25,4.01348 -25,38.5 0,34.48652 25,38.5 25,38.5 h 215 c 0,0 20,-0.99604 20,-25 0,-24.00396 -20,-25 -20,-25 h -190 c 0,0 -20,1.71033 -20,25 0,24.00396 20,25 20,25 h 168.57143" />
                            </svg>
                            <div class="form">
                                <label for="email">Email</label>
                                <input type="email" id="email">
                                <label for="password">Requested Date</label>
                                <input type="date" id="password">
                                <input type="submit" id="submit" value="Submit">
                            </div>
                        </div>
                    </div>
                  </div>
            </div>
        </div>
        <!-- <div id="form" style="display: none; position:relative; background-color:#fff">
            <form>
                <ul>
                    <li>
                      <label for="name">Name:</label>
                      <input type="text" id="name" name="name">
                    </li>
                    <li>
                      <label for="start_time">E-mail:</label>
                      <input type="text" id="start_time" name="start_time">
                    </li>
                    <li>
                      <label for="end_time">Message:</label>
                      <textarea text="text" id="end_time" name="end_time"></textarea>
                    </li>
                    <input type="submit" value="Request Availability">
                </ul>
            </form>
        </div> -->
        <script>
            var modal = document.getElementById("myModal");
            var btn = document.getElementById("close");
            
            btn.onclick = function() {
                modal.style.display = "none";
            }
    
            // Just the same way to initialize as always...
            map = new Mazemap.Map({
            "container": "map",
            "campuses": 89,
            "center": {
                "lng": -73.56795092623447,
                "lat": 45.503502511197446
            },
            "zoom": 20,
            "zLevel": 1,
            "scrollZoom": true,
            "doubleClickZoom": true,
            "touchZoomRotate": true
            });
    
            const basicVertexX1 = -73.56795;
            const basicVertexY1 = 45.50350;
            const basicVertexX2 = basicVertexX1 + 0.00003;
            const basicVertexY2 = basicVertexY1 + 0.00003;
            //format in {Lat, Long} == {X, Y}
            var CUSTOM_FEATURES = [
                {
                    type: "Feature",
                    properties: { zLevel: 1, name: 'Desk A' },
                    geometry: {
                        type: "Polygon",
                        coordinates: [ [[basicVertexX1, basicVertexY1],
                                        [basicVertexX1, basicVertexY2],
                                        [basicVertexX2, basicVertexY2],
                                        [basicVertexX2, basicVertexY1] ] ]
                                        // [12.523013,55.787037],
                                        // [12.523118,55.787017],
                                        // [12.523132,55.787038], [12.523030,55.787066] ] ]
                        //  coordinates: [ [  [12.523030,55.787066],
                        //                 [12.523013,55.787037],
                        //                 [12.523118,55.787017],
                        //                 [12.523132,55.787038], [12.523030,55.787066] ] ]
                        // coord 1: 0.000017, 0.000029
    
                    }
                },
                {
                    type: "Feature",
                    properties: { zLevel: 1, name: 'Desk B' },
                    geometry: {
                        type: "Polygon",
                        coordinates: [ [[basicVertexX1 - 0.00005, basicVertexY1 - 0.00005],
                                        [basicVertexX1 - 0.00005, basicVertexY2 - 0.00005],
                                        [basicVertexX2 - 0.00005, basicVertexY2 - 0.00005],
                                        [basicVertexX2 - 0.00005, basicVertexY1 - 0.00005] ] ]
    
                    }
    
                },
                {
                    type: "Feature",
                    properties: { zLevel: 1, name: 'Desk C' },
                    geometry: {
                        type: "Polygon",
                        coordinates: [ [[basicVertexX1 -  0.00010, basicVertexY1 -  0.00010],
                                        [basicVertexX1 -  0.00010, basicVertexY2 -  0.00010],
                                        [basicVertexX2 -  0.00010, basicVertexY2 -  0.00010],
                                        [basicVertexX2 -  0.00010, basicVertexY1 -  0.00010] ] ]
    
                    }
    
                }
            ];
    
            map.on('load', function(){
    
                map.setCenter([-73.56795092623447, 45.503502511197446 ]);
                map.addLayer({
                    id: 'custom-polygon-layer',
                    type: "fill",
                    source: {
                        type: 'geojson',
                        data: null,
                    },
                    paint: {
                        "fill-color": "#fc0",
                        "fill-outline-color": "red"
                    }
                });

                
                map.layerEventHandler.on('click', null, () => {
                    modal.style.display = "none";
                })
    
                map.layerEventHandler.on('click', 'custom-polygon-layer', (e, features) => {
                    
                    console.log('@@@ clicked custom-polygon-layer features: ', features);
                    var topFeature = features[0];
                    console.log("you clicked feature named: " + topFeature.properties.name);
                    document.getElementById("myModal").style.display = "block";
                });
    
                map.on('zlevel', redrawPolygons);
                redrawPolygons();
    
            });
    
    
            function redrawPolygons() {
                var zLevel = map.getZLevel();
    
                var filteredFeatures = CUSTOM_FEATURES.filter( feature => feature.properties.zLevel === zLevel );
    
                map.getSource("custom-polygon-layer").setData({type: "FeatureCollection", features: filteredFeatures});
            }
        </script>
    </div>
</body>