<!DOCTYPE html>
<head>
    <meta name="viewport" id="vp" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width" />
    <meta charset="utf-8" />

    <link rel="stylesheet" href="https://api.mazemap.com/js/v2.0.63/mazemap.min.css">
    <script type='text/javascript' src='https://api.mazemap.com/js/v2.0.63/mazemap.min.js'></script>

    <style>
        body { margin:0px; padding:0px; width: 100vw; height:100vh; font-family: "Helvetica Neue",Helvetica,Arial,sans-serif; font-size: 14px; line-height: 1.42857143; }
        hr { border: 0; height: 1px; background-color: rgb(216, 216, 216); }


        #events{
            position: absolute;
            box-sizing: border-box;
            padding: 10px;
            top: 10px;
            left: 10px;
            width: auto;
            height: auto;
            width: calc( 50% - 20px );
            display: flex;
            background: rgb(255, 255, 255);
            border-radius: 4px;
            box-shadow: 0px 0px 0px 1px rgba(93, 93, 93, 0.31)
        }
    </style>
</head>
<body>
    <div id="wrapper">
        <div id="map" class="mazemap"></div>
        <div id="myModal" class="modal" style="display: none; position: relative;">
            <!-- Modal content -->
            <div class="modal-content">
                <button id="close">Close</button>
                <form>
                    <ul>
                        <li>
                            <label for="name">Name:</label>
                            <input type="text" id="name" name="name">
                        </li>
                        <li>
                            <label for="start_time">E-mail:</label>
                            <input type="text" id="start_time" name="start_time">
                        </li>
                        <li>
                            <label for="end_time">Message:</label>
                            <textarea text="text" id="end_time" name="end_time"></textarea>
                        </li>
                        <input type="submit" value="Request Availability">
                    </ul>
                </form>
            </div>
        </div>
        <!-- <div id="form" style="display: none; position:relative; background-color:#fff">
            <form>
                <ul>
                    <li>
                      <label for="name">Name:</label>
                      <input type="text" id="name" name="name">
                    </li>
                    <li>
                      <label for="start_time">E-mail:</label>
                      <input type="text" id="start_time" name="start_time">
                    </li>
                    <li>
                      <label for="end_time">Message:</label>
                      <textarea text="text" id="end_time" name="end_time"></textarea>
                    </li>
                    <input type="submit" value="Request Availability">
                </ul>
            </form>
        </div> -->
        <script>
            var modal = document.getElementById("myModal");
            var btn = document.getElementById("close");
            
            btn.onclick = function() {
                modal.style.display = "none";
            }
    
            // Just the same way to initialize as always...
            map = new Mazemap.Map({
            "container": "map",
            "campuses": 89,
            "center": {
                "lng": -73.56795092623447,
                "lat": 45.503502511197446
            },
            "zoom": 20,
            "zLevel": 1,
            "scrollZoom": true,
            "doubleClickZoom": true,
            "touchZoomRotate": true
            });
    
            const basicVertexX1 = -73.56795;
            const basicVertexY1 = 45.50350;
            const basicVertexX2 = basicVertexX1 + 0.00003;
            const basicVertexY2 = basicVertexY1 + 0.00003;
            //format in {Lat, Long} == {X, Y}
            var CUSTOM_FEATURES = [
                {
                    type: "Feature",
                    properties: { zLevel: 1, name: 'Desk A' },
                    geometry: {
                        type: "Polygon",
                        coordinates: [ [[basicVertexX1, basicVertexY1],
                                        [basicVertexX1, basicVertexY2],
                                        [basicVertexX2, basicVertexY2],
                                        [basicVertexX2, basicVertexY1] ] ]
                                        // [12.523013,55.787037],
                                        // [12.523118,55.787017],
                                        // [12.523132,55.787038], [12.523030,55.787066] ] ]
                        //  coordinates: [ [  [12.523030,55.787066],
                        //                 [12.523013,55.787037],
                        //                 [12.523118,55.787017],
                        //                 [12.523132,55.787038], [12.523030,55.787066] ] ]
                        // coord 1: 0.000017, 0.000029
    
                    }
                },
                {
                    type: "Feature",
                    properties: { zLevel: 1, name: 'Desk B' },
                    geometry: {
                        type: "Polygon",
                        coordinates: [ [[basicVertexX1 - 0.00005, basicVertexY1 - 0.00005],
                                        [basicVertexX1 - 0.00005, basicVertexY2 - 0.00005],
                                        [basicVertexX2 - 0.00005, basicVertexY2 - 0.00005],
                                        [basicVertexX2 - 0.00005, basicVertexY1 - 0.00005] ] ]
    
                    }
    
                },
                {
                    type: "Feature",
                    properties: { zLevel: 1, name: 'Desk C' },
                    geometry: {
                        type: "Polygon",
                        coordinates: [ [[basicVertexX1 -  0.00010, basicVertexY1 -  0.00010],
                                        [basicVertexX1 -  0.00010, basicVertexY2 -  0.00010],
                                        [basicVertexX2 -  0.00010, basicVertexY2 -  0.00010],
                                        [basicVertexX2 -  0.00010, basicVertexY1 -  0.00010] ] ]
    
                    }
    
                }
            ];
    
            map.on('load', function(){
    
                map.setCenter([-73.56795092623447, 45.503502511197446 ]);
                map.addLayer({
                    id: 'custom-polygon-layer',
                    type: "fill",
                    source: {
                        type: 'geojson',
                        data: null,
                    },
                    paint: {
                        "fill-color": "#fc0",
                        "fill-outline-color": "red"
                    }
                });

                
                map.layerEventHandler.on('click', null, () => {
                    modal.style.display = "none";
                })
    
                map.layerEventHandler.on('click', 'custom-polygon-layer', (e, features) => {
                    
                    console.log('@@@ clicked custom-polygon-layer features: ', features);
                    var topFeature = features[0];
                    console.log("you clicked feature named: " + topFeature.properties.name);
                    document.getElementById("myModal").style.display = "block";
                });
    
                map.on('zlevel', redrawPolygons);
                redrawPolygons();
    
            });
    
    
            function redrawPolygons() {
                var zLevel = map.getZLevel();
    
                var filteredFeatures = CUSTOM_FEATURES.filter( feature => feature.properties.zLevel === zLevel );
    
                map.getSource("custom-polygon-layer").setData({type: "FeatureCollection", features: filteredFeatures});
            }
        </script>
    </div>
</body>